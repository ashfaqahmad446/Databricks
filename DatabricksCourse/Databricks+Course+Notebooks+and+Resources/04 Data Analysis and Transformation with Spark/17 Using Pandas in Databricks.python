{"version":"NotebookV1","origId":3603969348519963,"name":"17 Using Pandas in Databricks","language":"python","commands":[{"version":"CommandV1","origId":3603969348519964,"guid":"d6594db4-fc99-42ca-b2bb-75bce1880f2c","subtype":"command","commandType":"auto","position":0.5,"command":"%md\n# Using Pandas in Databricks\n\n#### Resources:\n* Pandas API on Spark: https://spark.apache.org/docs/latest/api/python/reference/pyspark.pandas/index.html","commandVersion":16,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a2022b02-2407-4e85-a06e-49c9117966a1"},{"version":"CommandV1","origId":3603969348519965,"guid":"98d258f2-3a28-451a-9daa-fb56e9ec9e88","subtype":"command","commandType":"auto","position":1.0,"command":"# Reading in the countries csv file\ncountries_path = '/FileStore/tables/countries.csv'\n\nfrom pyspark.sql.types import IntegerType, StringType, DoubleType, StructField, StructType\ncountries_schema = StructType([\n                    StructField(\"COUNTRY_ID\", IntegerType(), False),\n                    StructField(\"NAME\", StringType(), False),\n                    StructField(\"NATIONALITY\", StringType(), False),\n                    StructField(\"COUNTRY_CODE\", StringType(), False),\n                    StructField(\"ISO_ALPHA2\", StringType(), False),\n                    StructField(\"CAPITAL\", StringType(), False),\n                    StructField(\"POPULATION\", DoubleType(), False),\n                    StructField(\"AREA_KM2\", IntegerType(), False),\n                    StructField(\"REGION_ID\", IntegerType(), True),\n                    StructField(\"SUB_REGION_ID\", IntegerType(), True),\n                    StructField(\"INTERMEDIATE_REGION_ID\", IntegerType(), True),\n                    StructField(\"ORGANIZATION_REGION_ID\", IntegerType(), True)\n                    ]\n                    )\n\ncountries=spark.read.csv(path=countries_path, header=True, schema=countries_schema)","commandVersion":12,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"countries","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"COUNTRY_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"NAME","nullable":true,"type":"string"},{"metadata":{},"name":"NATIONALITY","nullable":true,"type":"string"},{"metadata":{},"name":"COUNTRY_CODE","nullable":true,"type":"string"},{"metadata":{},"name":"ISO_ALPHA2","nullable":true,"type":"string"},{"metadata":{},"name":"CAPITAL","nullable":true,"type":"string"},{"metadata":{},"name":"POPULATION","nullable":true,"type":"double"},{"metadata":{},"name":"AREA_KM2","nullable":true,"type":"integer"},{"metadata":{},"name":"REGION_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"SUB_REGION_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"INTERMEDIATE_REGION_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"ORGANIZATION_REGION_ID","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1665914154451,"submitTime":1665914154392,"finishTime":1665914154613,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"01e8d5e1-3d5e-4ac9-978b-1b818ad0488f"},{"version":"CommandV1","origId":3603969348519966,"guid":"c427a340-611f-44ca-8a2e-d829f4537a3e","subtype":"command","commandType":"auto","position":2.0,"command":"# Importing the pandas library\nimport pandas as pd","commandVersion":13,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1665914232572,"submitTime":1665914232521,"finishTime":1665914232772,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2b91f497-dd48-4ead-84b8-b10aebafc76c"},{"version":"CommandV1","origId":3603969348519967,"guid":"068faa37-d60f-4f4f-bf5a-ec1bc35deae8","subtype":"command","commandType":"auto","position":3.0,"command":"# Converting a spark dataframe to a pandas dataframe using toPandas()\ncountries_pd = countries.toPandas()","commandVersion":19,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1665914243688,"submitTime":1665914243660,"finishTime":1665914244074,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5d1957b1-31df-4450-83a7-20f5ec89c25b"},{"version":"CommandV1","origId":3603969348519968,"guid":"45cb95fb-0f35-46c5-92db-75fce3a33899","subtype":"command","commandType":"auto","position":4.0,"command":"# You can now use Pandas on the resulting dataframe\ncountries_pd.iloc[0]","commandVersion":24,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[6]: COUNTRY_ID                          1\nNAME                      Afghanistan\nNATIONALITY                    Afghan\nCOUNTRY_CODE                      AFG\nISO_ALPHA2                         AF\nCAPITAL                         Kabul\nPOPULATION                 38041754.0\nAREA_KM2                     652230.0\nREGION_ID                          30\nSUB_REGION_ID                    30.0\nINTERMEDIATE_REGION_ID            NaN\nORGANIZATION_REGION_ID             30\nName: 0, dtype: object</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1665914282466,"submitTime":1665914282431,"finishTime":1665914282490,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",513]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f682dfd1-0ce3-45ea-a566-47b4d1796a45"}],"dashboards":[],"guid":"f0511a50-a068-4d63-bcdb-d98955de5798","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}