{"version":"NotebookV1","origId":3603969348519884,"name":"13 Pivotting Dataframes","language":"python","commands":[{"version":"CommandV1","origId":3603969348519885,"guid":"e0744c50-8808-4a00-b117-5820dbd4c6d7","subtype":"command","commandType":"auto","position":0.5,"command":"%md\n# Pivotting Dataframes\n\n#### Resources: \n* pivot: https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.GroupedData.pivot.html?highlight=pivot#pyspark.sql.GroupedData.pivot","commandVersion":17,"state":"input","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cf5154fd-cd1e-468b-ad64-6ecea77b6a5a"},{"version":"CommandV1","origId":3603969348519886,"guid":"e75ecfb5-2f59-4ae6-bbce-27970a3357f4","subtype":"command","commandType":"auto","position":1.0,"command":"# Reading in the countries csv file into a Dataframe\ncountries_path = '/FileStore/tables/countries.csv'\n\nfrom pyspark.sql.types import IntegerType, StringType, DoubleType, StructField, StructType\ncountries_schema = StructType([\n                    StructField(\"COUNTRY_ID\", IntegerType(), False),\n                    StructField(\"NAME\", StringType(), False),\n                    StructField(\"NATIONALITY\", StringType(), False),\n                    StructField(\"COUNTRY_CODE\", StringType(), False),\n                    StructField(\"ISO_ALPHA2\", StringType(), False),\n                    StructField(\"CAPITAL\", StringType(), False),\n                    StructField(\"POPULATION\", DoubleType(), False),\n                    StructField(\"AREA_KM2\", IntegerType(), False),\n                    StructField(\"REGION_ID\", IntegerType(), True),\n                    StructField(\"SUB_REGION_ID\", IntegerType(), True),\n                    StructField(\"INTERMEDIATE_REGION_ID\", IntegerType(), True),\n                    StructField(\"ORGANIZATION_REGION_ID\", IntegerType(), True)\n                    ]\n                    )\n\ncountries=spark.read.csv(path=countries_path, header=True, schema=countries_schema)\n\n","commandVersion":11,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"countries","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"COUNTRY_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"NAME","nullable":true,"type":"string"},{"metadata":{},"name":"NATIONALITY","nullable":true,"type":"string"},{"metadata":{},"name":"COUNTRY_CODE","nullable":true,"type":"string"},{"metadata":{},"name":"ISO_ALPHA2","nullable":true,"type":"string"},{"metadata":{},"name":"CAPITAL","nullable":true,"type":"string"},{"metadata":{},"name":"POPULATION","nullable":true,"type":"double"},{"metadata":{},"name":"AREA_KM2","nullable":true,"type":"integer"},{"metadata":{},"name":"REGION_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"SUB_REGION_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"INTERMEDIATE_REGION_ID","nullable":true,"type":"integer"},{"metadata":{},"name":"ORGANIZATION_REGION_ID","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1665911736520,"submitTime":1665911552572,"finishTime":1665911739405,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["html",27]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a1e009bf-89e4-48e2-bfb8-4517d2b1fa1b"},{"version":"CommandV1","origId":3603969348519887,"guid":"c2bb05a3-c5d1-4c3a-8fd6-f0e181b9819f","subtype":"command","commandType":"auto","position":2.0,"command":"# Using pivot after groupyBy to pivot on the region_id column\ncountries.groupBy('sub_region_id').pivot('region_id').sum('population').display()","commandVersion":37,"state":"finished","results":{"type":"listResults","data":[{"type":"table","data":[[140,null,2.93444913E8,null,null,null],[null,null,null,null,1106.0,null],[40,null,null,null,null,2.41780768E8],[20,null,null,null,679839.0,null],[120,null,1.05791728E8,null,null,null],[100,null,null,6.62011806E8,null,null],[130,null,null,null,1.0918517E7,null],[10,6.48120719E8,null,null,null,null],[50,null,null,null,543786.0,null],[80,3.66600964E8,null,null,null,null],[160,null,null,null,null,1.066287151E9],[70,null,1.52446923E8,null,null,null],[60,null,null,1.672611098E9,null,null],[90,null,null,null,2.9990396E7,null],[170,null,null,2.75324813E8,null,null],[110,null,null,7.32121E7,null,null],[150,null,1.9552241E8,null,null,null],[30,null,null,1.918211381E9,null,null]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"sub_region_id","type":"\"integer\"","metadata":"{}"},{"name":"10","type":"\"double\"","metadata":"{}"},{"name":"20","type":"\"double\"","metadata":"{}"},{"name":"30","type":"\"double\"","metadata":"{}"},{"name":"40","type":"\"double\"","metadata":"{}"},{"name":"50","type":"\"double\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[],"columnCustomDisplayInfos":{},"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{"isDbfsCommandResult":false}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"baseErrorDetails":null,"workflows":[],"startTime":1665911853616,"submitTime":1665911853571,"finishTime":1665911854742,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[["table",18]],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0c36afb9-bc95-47de-9874-48c21e0c1888"}],"dashboards":[],"guid":"4dbafa56-09c6-4264-88d0-bf8f7a357e4f","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":4},"reposExportFormat":"SOURCE"}